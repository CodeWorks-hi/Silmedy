<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>지도 선택</title>
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=419a7c3d16ed763e81eddab1b53cc3f3&autoload=true&libraries=services"></script>
    <style>
        #map {
            width: 100%;
            height: 90vh;
        }

        #confirmBtn {
            width: 100%;
            height: 10vh;
            font-size: 16px;
            font-weight: 600;
            background-color: #448AFF;
            color: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease;
        }

        #confirmBtn:disabled {
            background-color: #cccccc;
        }

        #confirmBtn:hover:enabled {
            background-color: #1A73E8;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id="map"></div>
<button id="confirmBtn" disabled>위치 선택 완료</button>

<script>
    let selectedAddress = null;
    let selectedLat = null;
    let selectedLng = null;

    kakao.maps.load(function () {
        const container = document.getElementById('map');
        const options = {
            center: new kakao.maps.LatLng(37.5665, 126.9780),
            level: 3
        };
        const map = new kakao.maps.Map(container, options);
        const geocoder = new kakao.maps.services.Geocoder();
        const marker = new kakao.maps.Marker({ map: map });

        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
            const latlng = mouseEvent.latLng;
            marker.setPosition(latlng);

            selectedLat = latlng.getLat();
            selectedLng = latlng.getLng();

            geocoder.coord2Address(latlng.getLng(), latlng.getLat(), function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    selectedAddress = result[0].address.address_name;
                    document.getElementById('confirmBtn').disabled = false;
                } else {
                    console.log("지오코딩 실패 상태:", status);
                }
            });
        });
    });

    document.getElementById('confirmBtn').addEventListener('click', function () {
        if (selectedAddress && selectedLat !== null && selectedLng !== null && window.Android && window.Android.onAddressSelected) {
            console.log("선택된 주소:", selectedAddress);
            console.log("위도:", selectedLat);
            console.log("경도:", selectedLng);
            window.Android.onAddressSelected(selectedAddress, selectedLat, selectedLng);
        } else {
            alert("주소가 선택되지 않았거나, 연결 실패");
        }
    });
</script>
</body>
</html>